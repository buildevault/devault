<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Character encoding in UTF-8 -->
    <meta charset="UTF-8">

    <!-- Browser tab title -->
    <title>DeVault</title>
    
    <!-- Link to CSS stylesheet using Flask url_for() function -->
    <!-- "static" being the folder and "style.css" the filename -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Link to JavaScript file to handle the dropdown toggle functionality -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>

</head>

<body>
    <!-- Main container: centers content and adds padding -->
    <div class="container">
        
        <!-- Header: title and description -->
        <header>
            <h1>DeVault</h1>
            <p>The task manager engineered for developers. All in one place, centralized.</p>
        </header>
        
        <!-- 1. Creation of a task field -->

        <!-- First dropdown menu -->
        <section class="dropdown-section">
            <!-- Clickable header of the menu to open or close (open by default) -->
            <div class="dropdown-header" onclick="toggleDropdown()">
                <h2>New Task</h2>
            </div>
            
            <!-- Dropdown content -->
            <div class="dropdown-content" id="dropdownContent">
                
                <!-- Task form -->
                <!-- When submitted, data are sent to the /add_task route -->
                <form action="{{ url_for('add_task') }}" method="POST" class="task-form">
                    
                    <!-- Title input field -->
                    <input
                        type="text" 
                        name="title" 
                        placeholder="Title" 
                        required
                        class="input-title"
                    >

                    <!-- Description text area -->
                    <textarea 
                        name="description" 
                        placeholder="Description" 
                        class="input-description"
                        rows="4"
                    ></textarea>
                    
                    <!-- Due date input -->
                    <div class="input-group">
                        <label for="dueDate">Due date</label>                    
                        <!-- Date picker -->
                        <input 
                            type="date" 
                            name="due_date" 
                            id="dueDate"
                            class="input-date"
                            required
                        >
                    </div>

                    <!-- 2. Individual features -->

                    <!-- Nested dropdown for unique options -->
                    <div class="nested-dropdown">
                        <!-- Clickable title to toggle options -->
                        <div class="nested-header" onclick="toggleOptions()">
                            <span class="nested-title">Developper options</span>
                        </div>
                        
                        <!-- Nested content hidden by default -->
                        <div class="nested-content collapsed" id="optionsContent">
                            




                            <!-- OPTION A: OPEN IN APP BY URI SCHEME -->

                            <label class="input-label">Open in application</label>
                            <p class="option-description">Select an app to link it with your task, once clicked it will automatically open.</p>

                            <!-- App selector grid: container for all available app cards -->
                            <div class="app-selector">
                                <!-- Hidden input: stores the selected app's URI scheme for form submission -->
                                <input type="hidden" name="app_uri" id="selectedAppUri" value="">
                                <!-- Loop through available apps: Jinja2 template loop from Flask -->
                                <!-- 'apps' variable comes from AVAILABLE_APPS list in app.py -->
                                {% for app in apps %}
                                <!-- data-uri: store the app URI -->
                                <!-- onclick call JavaScript function to manage app selection -->
                                <div class="app-card" 
                                    data-uri="{{ app.uri }}"   
                                    onclick="selectApp(this)"> <!-- calls JavaScript function to manage app selection -->
                                    
                                    <!-- App icon container -->
                                    <div class="app-icon">
                                        <!-- App icon image is loaded from static > icons -->
                                        <img src="{{ url_for('static', filename='icons/' + app.icon) }}">
                                    </div>
                                    
                                    <!-- App name: displays the application name below the icon -->
                                    <span class="app-name">{{ app.name }}</span>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="option-separator"></div>
                            




                            <!-- OPTION B: TODO DETECTION IN CODE -->                        

                            <div class="scanner-section">
                                <label class="input-label">Todo finder</label>
                                <p class="option-description">Scan a project folder to automatically convert TODO, BUG and FIXME comments into tasks.</p>
                                
                                <!-- Scanner control buttons and status display -->
                                <div class="scanner-controls">
                                    <!-- Call JavaScript function to open file selection window -->
                                    <button type="button" class="btn-scan" onclick="openDirectoryPicker()">
                                        Select a folder
                                    </button>
                                </div>
                            </div>
                            <!-- Print count of found TODO comments found -->
                            <div class="todo-results" id="todoResults" style="display: none;">
                                <div class="results-header">
                                    <!-- Dynamic counter automatically updated -->
                                    <h4>Found <span id="todoCount">0</span> TODO</h4>
                                </div>
                                <!-- The container is now populated by JavaScript with the results -->
                                <!-- Each TODO will show the file name, line number, and the text next to the TDOO -->
                                <div class="todo-list" id="todoList"></div>
                            </div>

                            <div class="option-separator"></div>

                            



                            <!-- OPTION C: GIT BRANCH LINKING -->

                            <label class="input-label">Git branch</label>
                            <p class="option-description">Associate a Git branch with this task for quick reference.</p>
                            
                            <div class="branch-input-group">
                                <input 
                                    type="text" 
                                    name="git_branch" 
                                    id="gitBranch"
                                    class="input-branch"
                                >
                            </div>
                            
                            <!-- GitHub informations for generation of a clickable link -->
                            <div class="github-info-section">
                                <p class="option-description">Alternatively, you can add your GitHub informations to make the branch clickable.</p>
                                <div class="github-inputs">
                                    <input 
                                        type="text" 
                                        name="github_username" 
                                        id="githubUsername"
                                        placeholder="Username"
                                        class="input-github"
                                    >
                                    <input 
                                        type="text" 
                                        name="github_repo" 
                                        id="githubRepo"
                                        placeholder="Repository"
                                        class="input-github"
                                    >
                                </div>
                            </div>
                            
                            <div class="option-separator"></div>
                            




                            <!-- OPTION D: VERSION SELECTION SECTION -->
                            
                            <label class="input-label">Version tracker</label>
                            <p class="option-description">Link a tool version with your task.</p>
                            
                            <div class="version-tracker">
                                <div class="version-entries" id="versionEntries">
                                </div>
                                <div class="version-buttons">
                                    <!-- The auto detect button calls the corresponding JavaScript function -->
                                    <button type="button" class="btn-auto-detect" onclick="autoDetectVersions()">
                                        Auto-detect
                                    </button>
                                    <!-- Users can also manually add details -->
                                    <button type="button" class="btn-add-version" onclick="addVersionEntry()">
                                        Manual
                                    </button>
                                </div>
                                
                                <!-- Hidden input to store version data as JSON -->
                                <input type="hidden" name="version_info" id="versionInfoInput">
                            </div>
                            
                            <!-- SEPARATOR -->
                            <div class="option-separator"></div>
                            



                            
                            <!-- OPTION E: CODE SNIPPET -->
                            
                            <label class="input-label">Code snippet</label>
                            <p class="option-description">Add a code snippet related to this task.</p>
                            
                            <div class="snippet-editor">
                                <textarea 
                                    name="code_snippet" 
                                    id="codeSnippet"
                                    placeholder="Paste your code here."
                                    class="snippet-textarea"
                                    rows="2"
                                ></textarea>
                            </div>
                            
                        </div>
                    </div>

                    <!-- Submit button to create task -->
                    <button type="submit" class="btn-submit">
                        Create Task
                    </button>
                    
                </form>
                
            </div>
        </section>
        
<!-- 3. Task list -->

        <section class="empty-section">
            <!-- Overview seaction header displaying the number of tasks -->
            <h2>Overview ({{ tasks|length }})</h2>
            
            <!-- Section content: displays all created tasks -->
            <div class="section-content">
                
                {% if tasks %}
                    <!-- Loop through all tasks and display them -->
                    {% for task in tasks %}
                    <div class="task-card {% if task.status == 'done' %}completed{% endif %}">
                        <!-- Task content container -->
                        <div class="task-content-wrapper">
                            
                            <!-- Task info -->
                            <div class="task-info">

                                <!-- Task title -->
                                <h3 class="task-title">{{ task.title }}</h3>

                                <!-- Task description (if exists) -->
                                {% if task.description %}
                                <p class="task-description">{{ task.description }}</p>
                                {% endif %}

                                <!-- Code snippet (if exists) -->
                                {% if task.code_snippet %}
                                <div class="task-snippet-container">
                                    <div class="task-snippet-header">
                                        <span class="snippet-label">CODE SNIPPET</span>
                                        <!-- Button allowing copying to clipboard -->
                                        <button type="button" 
                                                class="btn-copy-snippet" 
                                                onclick="copySnippet(this, '{{ task.id }}')"
                                                title="Copy">
                                           Copy
                                        </button>
                                    </div>
                                    <pre class="task-snippet" id="snippet-{{ task.id }}"><code>{{ task.code_snippet }}</code></pre>
                                </div>
                                {% endif %}

                                <!-- Git branch (if exists) -->
                                {% if task.git_branch %}
                                <div class="task-branch-container">
                                    <div class="task-branch-header">
                                        <span class="branch-label">GIT BRANCH</span>
                                        <div class="branch-actions">
                                            <!-- If necessary fields are filled, creation of the direct link to GitHub -->
                                            {% if task.github_username and task.github_repo %}
                                            <a href="https://github.com/{{ task.github_username }}/{{ task.github_repo }}/tree/{{ task.git_branch }}" 
                                               target="_blank"
                                               class="btn-github-link"
                                               title="Open on GitHub">
                                               GitHub
                                            </a>
                                            {% endif %}
                                            <button type="button" 
                                                    class="btn-copy-branch" 
                                                    onclick="copyBranch(this, '{{ task.git_branch }}')"
                                                    title="Copy branch name">
                                               Copy
                                            </button>
                                        </div>
                                    </div>
                                    <div class="task-branch-name">{{ task.git_branch }}</div>
                                </div>
                                {% endif %}
                                
                                <!-- Version info (if exists) -->
                                {% if task.version_info %}
                                <div class="task-versions-container">
                                    <div class="version-badges" data-versions="{{ task.version_info | escape }}" id="taskVersions-{{ task.id }}">
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Task metadata -->
                                <div class="task-meta">

                                    <!-- Due date -->       
                                    <span class="task-due-date">
                                        Due: {{ task.due_date.strftime('%b %d, %Y')}}
                                    </span>
                                    
                                    <!-- App icon (if exists) -->
                                    {% if task.app_uri %}
                                        {% set app = get_app_by_uri(task.app_uri) %}
                                        {% if app %}
                                        <div class="task-app-icon" onclick="openApp('{{ task.app_uri }}')" title="Open in {{ app.name }}">
                                            <img src="{{ url_for('static', filename='icons/' + app.icon) }}">
                                        </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Task actions -->
                            <div class="task-actions">

                                <!-- Mark as done button -->
                                <a href="{{ url_for('toggle_task', task_id=task.id) }}" 
                                   class="btn-action btn-done"
                                   title="{% if task.status == 'done' %}Mark as todo{% else %}Mark as done{% endif %}">
                                    <!-- Icon for completed tasks -->
                                    {% if task.status == 'done' %}
                                    ‚úÖ
                                    <!-- Icon for todo tasks -->
                                    {% else %}
                                    üîò
                                    {% endif %}
                                </a>

                                <!-- Delete button and ask a confirmation -->
                                <a href="{{ url_for('delete_task', task_id=task.id) }}" 
                                   class="btn-action btn-delete"
                                   onclick="return confirm('Are you sure you want to delete this task ?')"
                                   title="Delete task">
                                   üóëÔ∏è
                                </a>

                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                {% else %}
                    <!-- text shown when no tasks have been entered -->
                    <p>No tasks yet...</p>
                {% endif %}
                
            </div>
        </section>

    </div>
    
</body>

</html>
